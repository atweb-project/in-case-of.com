(function(){var e=function(e){var t=this,n=e;e.require().script("ui/core","ui/widget").stylesheet("ui/menu").done(function(){var e=function(){(function(e){var t=0;e.widget("ui.menu",{version:"1.9pre",defaultElement:"<ul>",delay:300,options:{menus:"ul",position:{my:"left top",at:"right top"}},_create:function(){this.activeMenu=this.element,this.menuId=this.element.attr("id")||"ui-menu-"+t++,this.element.find(".ui-icon").length&&this.element.addClass("ui-menu-icons"),this.element.addClass("ui-menu ui-widget ui-widget-content ui-corner-all").attr({id:this.menuId,role:"menu"}).bind("click.menu",e.proxy(function(e){this.options.disabled&&e.preventDefault()},this)),this.options.disabled&&this.element.addClass("ui-state-disabled"),this._bind({"mousedown .ui-menu-item > a":function(e){e.preventDefault()},"click .ui-menu-item:has(a)":function(t){t.stopImmediatePropagation(),e(t.target).closest(".ui-menu-item").is(".ui-state-disabled")||(this.select(t),this._delay(function(){this.element.is(":focus")||this.element.focus()},20))},"mouseover .ui-menu-item":function(t){t.stopImmediatePropagation();var n=e(t.currentTarget);n.siblings().children(".ui-state-active").removeClass("ui-state-active"),this.focus(t,n)},mouseleave:"collapseAll","mouseleave .ui-menu":"collapseAll",focus:function(t){var n=this.element.children(".ui-menu-item").not(".ui-state-disabled").eq(0);if(this._hasScroll()&&!this.active){var r=this.element;r.children().each(function(){var t=e(this);if(t.offset().top-r.offset().top>=0)return n=t,!1})}else this.active&&(n=this.active);this.focus(t,n)},blur:function(t){this._delay(function(){e.contains(this.element[0],this.document[0].activeElement)||this.collapseAll(t)},0)}}),this.refresh(),this.element.attr("tabIndex",0),this._bind({keydown:function(t){switch(t.keyCode){case e.ui.keyCode.PAGE_UP:this.previousPage(t),t.preventDefault(),t.stopImmediatePropagation();break;case e.ui.keyCode.PAGE_DOWN:this.nextPage(t),t.preventDefault(),t.stopImmediatePropagation();break;case e.ui.keyCode.HOME:this._move("first","first",t),t.preventDefault(),t.stopImmediatePropagation();break;case e.ui.keyCode.END:this._move("last","last",t),t.preventDefault(),t.stopImmediatePropagation();break;case e.ui.keyCode.UP:this.previous(t),t.preventDefault(),t.stopImmediatePropagation();break;case e.ui.keyCode.DOWN:this.next(t),t.preventDefault(),t.stopImmediatePropagation();break;case e.ui.keyCode.LEFT:this.collapse(t)&&t.stopImmediatePropagation(),t.preventDefault();break;case e.ui.keyCode.RIGHT:this.expand(t)&&t.stopImmediatePropagation(),t.preventDefault();break;case e.ui.keyCode.ENTER:this.active.children("a[aria-haspopup='true']").length?this.expand(t)&&t.stopImmediatePropagation():(this.select(t),t.stopImmediatePropagation()),t.preventDefault();break;case e.ui.keyCode.ESCAPE:this.collapse(t)&&t.stopImmediatePropagation(),t.preventDefault();break;default:t.stopPropagation(),clearTimeout(this.filterTimer);var n,r=this.previousFilter||"",i=String.fromCharCode(t.keyCode),s=!1;i==r?s=!0:i=r+i;function o(e){return e.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&")}n=this.activeMenu.children(".ui-menu-item").filter(function(){return RegExp("^"+o(i),"i").test(e(this).children("a").text())}),n=s&&n.index(this.active.next())!=-1?this.active.nextAll(".ui-menu-item"):n,n.length||(i=String.fromCharCode(t.keyCode),n=this.activeMenu.children(".ui-menu-item").filter(function(){return RegExp("^"+o(i),"i").test(e(this).children("a").text())})),n.length?(this.focus(t,n),n.length>1?(this.previousFilter=i,this.filterTimer=this._delay(function(){delete this.previousFilter},1e3)):delete this.previousFilter):delete this.previousFilter}}}),this._bind(this.document,{click:function(t){e(t.target).closest(".ui-menu").length||this.collapseAll(t)}})},_destroy:function(){this.element.removeAttr("aria-activedescendant").find(".ui-menu").andSelf().removeClass("ui-menu ui-widget ui-widget-content ui-corner-all").removeAttr("role").removeAttr("tabIndex").removeAttr("aria-labelledby").removeAttr("aria-expanded").removeAttr("aria-hidden").show(),this.element.find(".ui-menu-item").unbind(".menu").removeClass("ui-menu-item").removeAttr("role").children("a").removeClass("ui-corner-all ui-state-hover").removeAttr("tabIndex").removeAttr("role").removeAttr("aria-haspopup").removeAttr("id").children(".ui-icon").remove()},refresh:function(){var t=this.element.find(this.options.menus+":not( .ui-menu )").addClass("ui-menu ui-widget ui-widget-content ui-corner-all").attr("role","menu").hide().attr("aria-hidden","true").attr("aria-expanded","false"),n=this.menuId;t.add(this.element).children(":not( .ui-menu-item ):has( a )").addClass("ui-menu-item").attr("role","presentation").children("a").addClass("ui-corner-all").attr("tabIndex",-1).attr("role","menuitem").attr("id",function(e){return n+"-"+e}),t.each(function(){var t=e(this),n=t.prev("a");n.attr("aria-haspopup","true").prepend('<span class="ui-menu-icon ui-icon ui-icon-carat-1-e"></span>'),t.attr("aria-labelledby",n.attr("id"))})},focus:function(t,n){this.blur(t);if(this._hasScroll()){var r=parseFloat(e.curCSS(this.activeMenu[0],"borderTopWidth",!0))||0,i=parseFloat(e.curCSS(this.activeMenu[0],"paddingTop",!0))||0,s=n.offset().top-this.activeMenu.offset().top-r-i,o=this.activeMenu.scrollTop(),u=this.activeMenu.height(),a=n.height();s<0?this.activeMenu.scrollTop(o+s):s+a>u&&this.activeMenu.scrollTop(o+s-u+a)}this.active=n.first().children("a").addClass("ui-state-focus").end(),this.element.attr("aria-activedescendant",this.active.children("a").attr("id")),this.active.parent().closest(".ui-menu-item").children("a:first").addClass("ui-state-active"),this.timer=this._delay(function(){this._close()},this.delay);var f=e("> .ui-menu",n);f.length&&/^mouse/.test(t.type)&&this._startOpening(f),this.activeMenu=n.parent(),this._trigger("focus",t,{item:n})},blur:function(e){clearTimeout(this.timer);if(!this.active)return;this.active.children("a").removeClass("ui-state-focus"),this.active=null,this._trigger("blur",e,{item:this.active})},_startOpening:function(e){clearTimeout(this.timer);if(e.attr("aria-hidden")!=="true")return;this.timer=this._delay(function(){this._close(),this._open(e)},this.delay)},_open:function(t){clearTimeout(this.timer),this.element.find(".ui-menu").not(t.parents()).hide().attr("aria-hidden","true");var n=e.extend({},{of:this.active},e.type(this.options.position)=="function"?this.options.position(this.active):this.options.position);t.show().removeAttr("aria-hidden").attr("aria-expanded","true").position(n)},collapseAll:function(t,n){clearTimeout(this.timer),this.timer=this._delay(function(){var r=n?this.element:e(t&&t.target).closest(this.element.find(".ui-menu"));r.length||(r=this.element),this._close(r),this.blur(t),this.activeMenu=r},this.delay)},_close:function(e){e||(e=this.active?this.active.parent():this.element),e.find(".ui-menu").hide().attr("aria-hidden","true").attr("aria-expanded","false").end().find("a.ui-state-active").removeClass("ui-state-active")},collapse:function(e){var t=this.active&&this.active.parent().closest(".ui-menu-item",this.element);if(t&&t.length)return this._close(),this.focus(e,t),!0},expand:function(e){var t=this.active&&this.active.children(".ui-menu ").children(".ui-menu-item").not(".ui-state-disabled").first();if(t&&t.length)return this._open(t.parent()),this._delay(function(){this.focus(e,t)},20),!0},next:function(e){this._move("next","first",e)},previous:function(e){this._move("prev","last",e)},isFirstItem:function(){return this.active&&!this.active.prevAll(".ui-menu-item").length},isLastItem:function(){return this.active&&!this.active.nextAll(".ui-menu-item").length},_move:function(e,t,n){var r;this.active&&(e==="first"||e==="last"?r=this.active[e==="first"?"prevAll":"nextAll"](".ui-menu-item").not(".ui-state-disabled").eq(-1):r=this.active[e+"All"](".ui-menu-item").not(".ui-state-disabled").eq(0));if(!r||!r.length||!this.active)r=this.activeMenu.children(".ui-menu-item")[t]();this.focus(n,r),r.is(".ui-state-disabled")&&this._move(e,t,n)},nextPage:function(t){if(!this.active){this._move("next","first",t);return}if(this.isLastItem())return;if(this._hasScroll()){var n=this.active.offset().top,r=this.element.height(),i;this.active.nextAll(".ui-menu-item").not(".ui-state-disabled").each(function(){return i=e(this),e(this).offset().top-n-r<0}),this.focus(t,i)}else this.focus(t,this.activeMenu.children(".ui-menu-item").not(".ui-state-disabled")[this.active?"last":"first"]())},previousPage:function(t){if(!this.active){this._move("next","first",t);return}if(this.isFirstItem())return;if(this._hasScroll()){var n=this.active.offset().top,r=this.element.height(),i;this.active.prevAll(".ui-menu-item").not(".ui-state-disabled").each(function(){return i=e(this),e(this).offset().top-n+r>0}),this.focus(t,i)}else this.focus(t,this.activeMenu.children(".ui-menu-item").not(".ui-state-disabled").first())},_hasScroll:function(){return this.element.outerHeight()<this.element.prop("scrollHeight")},select:function(e){var t={item:this.active};this.collapseAll(e,!0),this._trigger("select",e,t)}})})(n)};e(),t.resolveWith(e)})};dispatch("ui/menu").containing(e).to("Foundry/2.1 Modules")})();