Komento.module("migrator.common",function(a){var b=this;Komento.Controller("Migrator.Common",{defaults:{"{categoriesList}":"#category","{componentsList}":"#components","{publishingState}":"#publishingState","{migrateLikes}":"#migrateLikes"}},function(a){return{init:function(){a.migrationType=a.element.attr("migration-type"),a.migratorType=a.element.attr("migrator-type"),a.progress=a.element.find(".migratorProgress"),a.actions=a.element.parents(".tab")},getStatistic:function(){var b,c;switch(a.migrationType){case"component":c="components",b=a.componentsList().val();break;case"article":c="categories",b=a.categoriesList().val()}var d={};d[c]=b,Komento.ajax("admin.views.migrators.getmigrator",{type:a.migratorType,"function":"getstatistic",params:d},{success:function(b,c){a.progress.controller().setTotalPosts(b.length),a.progress.controller().setTotalComments(c),c>0&&a.migrate(b,0,b[0])},log:function(b){a.progress.controller().log(b)}})},migrate:function(b,c,d){if(d===undefined){a.actions.controller().migrateComplete();return}switch(a.migrationType){case"article":var e=d;d={component:a.migratorType,cid:e}}var f=a.publishingState().val(),g=a.migrateLikes().is(":checked")?1:0;Komento.ajax("admin.views.migrators.getmigrator",{type:a.migratorType,"function":"migrate",params:{component:d.component,cid:d.cid,publishingState:f,migrateLikes:g}},{success:function(){a.migrate(b,c+1,b[c+1])},fail:function(b){a.progress.controller().log("error: "+b)},update:function(b){a.progress.controller().updateMigratedComments(b)},log:function(b){a.progress.controller().log(b)}})}}}),b.resolve()});